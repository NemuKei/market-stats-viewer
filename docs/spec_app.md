# spec_app — UI / 表示仕様

## 目的
宿泊旅行統計調査の「延べ宿泊者数（全体/国内/海外）」を、都道府県×月次で表・グラフ表示する。

## 画面
- Streamlit単一ページ（`app.py`）

## 入力データ
- SQLite: `data/market_stats.sqlite`
- メタ: `data/meta.json`（存在する場合のみ表示）

## 表示要素

### ヘッダ
- タイトル：宿泊旅行統計調査：延べ宿泊者数（全体 / 国内 / 海外）
- メタ情報（任意、`meta.json` がある場合）
  - 最終取得日時（UTC）
  - 範囲（min_ym〜max_ym）
  - rows

### フィルタ
- 地域：全国（pref_code=00）＋都道府県（01〜47）
- 期間：開始年月 / 終了年月（ymリストから選択）
- 表示モード：表＋グラフ / 表のみ / グラフのみ

### 表
- 列：年月 / 全体 / 国内 / 海外
- ym昇順

### グラフ
- Altairの縦棒グラフを使用し、チャートモードを切替できる
  - 時系列（積み上げ縦棒：国内＋海外）
  - 年別（同月比較：全体/国内/海外）
- 表示幅は `use_container_width=True` を使用する
- ツールチップを表示する（年月/年/月/値、必要に応じて区分）

#### モードA：時系列（積み上げ縦棒：国内＋海外）
- x：年月（`ym`）
- y：延べ宿泊者数（`value`）
- color：国内/海外
- `jp` と `foreign` を積み上げ表示する
- 地域フィルタ（`pref_code`）と期間フィルタ（`ym_from`〜`ym_to`）を適用する

#### モードB：年別（同月比較：全体/国内/海外）
- x：月（`01`〜`12`、昇順固定）
- 系列：年（color）
- 表示形：同月内で年ごとに並ぶグループ化縦棒（積み上げなし）
- 指標切替：全体/国内/海外（単一指標）
- 年マルチセレクト：対象年を複数選択できる
  - 初期値は、選択地域で利用可能な最新4年（4年未満の場合は全件）
- データ範囲は「選択地域の全期間」を使用し、`ym_from`/`ym_to` では絞り込まない
- 上記の全期間データに対して、選択年のみを表示する

### データ欠損時の挙動
- `data/market_stats.sqlite` が無い、または読み込み結果が空の場合：
  - エラーメッセージを表示し、更新スクリプト実行を促す
  - アプリは例外で落とさない

### 出典表示
- 画面下部に固定で出典を表示（例：観光庁「宿泊旅行統計調査」）

## 非目標（MVPではやらない）
- ピボットの完全再現（複数軸の複雑な集計）
- ダウンロード機能（CSV出力など）
- 認証/権限（public想定）
